# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**

**Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.**

**salesman table**

| name            | type             |
|-----------------|------------------|
| salesman_id     | numeric(5)       |
| name            | varchar(30)      |
| city            | varchar(15)      |
| commission      | decimal(5,2)     |

**customer table**

| name            | type             |
|-----------------|------------------|
| customer_id     | int              |
| cust_name       | text             |
| city            | text             |
| grade           | int              |
| salesman_id     | int              |

```sql
select * from customer where customer_id = (select salesman_id - 2001 from salesman where name = 'Mc Lyon');
```

**Output:**

![image](https://github.com/user-attachments/assets/7361a3a7-24cd-4cf1-a71f-ce397ceb5e5f)

**Question 2**

**Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $1500.**

**Sample table: CUSTOMERS**

| ID  | NAME    | AGE  | ADDRESS    | SALARY |
|-----|---------|------|------------|--------|
| 1   | Ramesh  | 32   | Ahmedabad  | 2000   |
| 2   | Khilan  | 25   | Delhi      | 1500   |
| 3   | Kaushik | 23   | Kota       | 2000   |
| 4   | Chaitali| 25   | Mumbai     | 6500   |
| 5   | Hardik  | 27   | Bhopal     | 8500   |
| 6   | Komal   | 22   | Hyderabad  | 4500   |
| 7   | Muffy   | 24   | Indore     | 10000  |

```sql
select * from customers where id in (select id from customers where salary > 1500)
```

**Output:**

![image](https://github.com/user-attachments/assets/c0ca7270-dfca-4a02-8202-80f8e57996f6)

**Question 3**

**Write a SQL query that retrieves all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.**

**Sample table: GRADES**

![image](https://github.com/user-attachments/assets/a8760c0d-786d-4309-9705-5beaec5bbf75)

```sql
SELECT student_id, student_name, subject, grade
FROM grades g1
WHERE grade = (
    SELECT MIN(grade)
    FROM grades g2
    WHERE g1.subject = g2.subject
)

```

**Output:**

![image](https://github.com/user-attachments/assets/9156207f-623d-4583-b522-3d05d30aee87)

**Question 4**

**Write a SQL query to find the order values greater than the average order value of 10th October 2012. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.**

**Note:** The date format should be `yyyy-mm-dd`.

**ORDERS TABLE**

| name            | type    |
|-----------------|---------|
| **ord_no**      | int     |
| **purch_amt**   | real    |
| **ord_date**    | text    |
| **customer_id** | int     |
| **salesman_id** | int     |

```sql
select * from orders where purch_amt > (select purch_amt from orders where ord_date = '2012-10-10')
```

**Output:**

![image](https://github.com/user-attachments/assets/013e47fa-ce55-4983-9a3d-35753744fd42)

**Question 5**

**Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is LESS than $2500.**

**Sample table: CUSTOMERS**

| ID  | NAME      | AGE  | ADDRESS     | SALARY |
|-----|-----------|------|-------------|--------|
| 1   | Ramesh    | 32   | Ahmedabad   | 2000   |
| 2   | Khilan    | 25   | Delhi       | 1500   |
| 3   | Kaushik   | 23   | Kota        | 2000   |
| 4   | Chaitali  | 25   | Mumbai      | 6500   |
| 5   | Hardik    | 27   | Bhopal      | 8500   |
| 6   | Komal     | 22   | Hyderabad   | 4500   |
| 7   | Muffy     | 24   | Indore      | 10000  |

```sql
select * from customers where id in (select id from customers where salary < 2500)
```

**Output:**

![image](https://github.com/user-attachments/assets/d4ec7b15-df59-4c95-983a-32ebc726bc71)

**Question 6**

**From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.**

**salesman table**

| name        | type        |
|-------------|-------------|
| salesman_id | numeric(5)  |
| name        | varchar(30) |
| city        | varchar(15) |
| commission  | decimal(5,2)|

**orders table**

| name        | type    |
|-------------|---------|
| order_no    | int     |
| purch_amt   | real    |
| order_date  | text    |
| customer_id | int     |
| salesman_id | int     |

```sql
select * from orders where salesman_id in (select salesman_id from salesman where city = 'London')
```

**Output:**

![image](https://github.com/user-attachments/assets/445b10d2-a084-4ba7-b2bf-4ea68cc4cbc0)

**Question 7**

**Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject.**

**Sample table: GRADES**

![image](https://github.com/user-attachments/assets/3ebd981a-dce3-47b5-a007-8b04f7cf166d)

```sql
select * from grades g1 where grade = (select max(grade) from grades g2 where g1.subject = g2.subject)
```

**Output:**

![image](https://github.com/user-attachments/assets/610b6e21-bd79-4262-8fed-be3eba58d3f6)

**Question 8**

**Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi and age below 30**

**Sample table: CUSTOMERS**

| ID   | NAME      | AGE | ADDRESS    | SALARY |
|------|-----------|-----|------------|--------|
| 1    | Ramesh    | 32  | Ahmedabad  | 2000   |
| 2    | Khilan    | 25  | Delhi      | 1500   |
| 3    | Kaushik   | 23  | Kota       | 2000   |
| 4    | Chaitali  | 25  | Mumbai     | 6500   |
| 5    | Hardik    | 27  | Bhopal     | 8500   |
| 6    | Komal     | 22  | Hyderabad  | 4500   |
| 7    | Muffy     | 24  | Indore     | 10000  |

```sql
select * from customers where id in (select id from customers where age < 30 and address = 'Delhi')
```

**Output:**

![image](https://github.com/user-attachments/assets/35cce715-46d8-41bd-bb1d-52593a23513c)

**Question 9**

**Write a SQL query to find those salespeople who earned the maximum commission. Return ord_no, purch_amt, ord_date, and salesman_id.**

**Salesman table:**

| Column Name      | Data Type     |
|------------------|---------------|
| salesman_id      | numeric(5)    |
| name             | varchar(30)   |
| city             | varchar(15)   |
| commission       | decimal(5,2)  |

**Orders table:**

| Column Name      | Data Type     |
|------------------|---------------|
| order_no         | int           |
| purch_amt        | real          |
| order_date       | text          |
| customer_id      | int           |
| salesman_id      | int           |

```sql
select ord_no,purch_amt,ord_date,salesman_id from orders where salesman_id in (select salesman_id from salesman where commission = (select max(commission) from salesman))
```

**Output:**

![image](https://github.com/user-attachments/assets/78c426f1-8cdd-48ac-a25b-9223403ddbeb)

**Question 10**

**Write a SQL query to find employees who have an age less than the average age of employees with incomes over 2.5 Lakh.**

**Employee Table:**

| Column Name | Data Type |
|-------------|-----------|
| id          | INTEGER  |
| name        | TEXT     |
| age         | INTEGER  |
| city        | TEXT     |
| income      | INTEGER  |

```sql
select * from employee where id in (select id from employee where age < (select avg(age) from employee where income > 250000))
```

**Output:**

![image](https://github.com/user-attachments/assets/81321839-4b17-4fdd-8dba-d871ff42efbe)

**MODULE-4 GRADE**

![image](https://github.com/user-attachments/assets/e49c1065-ac14-4da6-8bfc-f00c162313e0)

## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
